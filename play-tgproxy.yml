---
- hosts: all
  remote_user: root
  vars:
    proxy_secret: !vault |
              $ANSIBLE_VAULT;1.1;AES256
              61363835383233623565316537383335666236326234313964353164643364396331613261643537
              6232386561333862343663653063363638323166333838360a303038383965373761636366666666
              35343966326338636366316633353963356361343235383430373731336463396438303263393936
              3166643931653530350a616639393364613263336333656433663730393865353362323261356465
              34383033666162353331326636313932616334363439396161646137653630653664626631623237
              3461616431353337336437656135613636643833336239323063
    
    proxy_tag: !vault |
              $ANSIBLE_VAULT;1.1;AES256
              31643233663938373462363063643738393132306363383139656463656464613464636134306235
              6539636263393161643534643065363662386533323066640a313033323138356332383563333734
              65623262663761613738653266656231303339326536356665663930386537393762306135306132
              3638613038383637610a366265396630656664396663393261346330323930333865363237336661
              66653933393065383364653464343033343462353438353934663035623237643530343339353531
              3166343263343963376535643037303465343262396232343333
  tasks:
    - name: Up telegram proxy container
      docker_container:
        name: tgproxy
        image: telegrammessenger/proxy
        pull: yes
        restart_policy: always
        ports:
          - "443:443"
        env:
          SECRET: "{{ proxy_secret }}"
          TAG: "{{ proxy_tag }}"